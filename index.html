<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ActiveRecord PHP by lukebaker</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>ActiveRecord PHP</h1>
        <p>ActiveRecord in PHP</p>

        <p class="view"><a href="https://github.com/lukebaker/activerecord-php">View the Project on GitHub <small>lukebaker/activerecord-php</small></a></p>


        <ul>
          <li><a href="https://github.com/lukebaker/activerecord-php/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/lukebaker/activerecord-php/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/lukebaker/activerecord-php">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="activerecord-in-php" class="anchor" href="#activerecord-in-php" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ActiveRecord In PHP</h1>

<h2>
<a id="motivation" class="anchor" href="#motivation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Motivation</h2>

<p>I wrote this after having been spoiled by Ruby on Rails’ implementation
of the ActiveRecord pattern, while still needing to work primarily in
PHP. When I started this, there did exist some
ORM options in PHP.
However, I wasn’t satisfied with any one in particular. My goals were to
create an implementation that was very similar to the Rails syntax, easy
to install, and fast.</p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>  PHP5</li>
<li>  Naming of tables and columns that follows the Rails convention.</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<ol>
<li> Create your database and tables, if you haven’t already. (remember
use Rails’ conventions for table and column names)</li>
<li>
<p>Download <a href="https://github.com/lukebaker/activerecord-php/tags">recent ActiveRecord release</a> or</p>

<pre><code>git clone https://github.com/lukebaker/activerecord-php.git
</code></pre>
</li>
<li><p>Untar into a models/ directory within your project or move checked
out directory activerecord-php/ into your models/ directory.</p></li>
<li> There should now be a models/activerecord-php/ directory, edit
models/activerecord-php/config.php to your liking.</li>
<li> Run models/activerecord-php/generate.php</li>
<li> This should have have generated model stubs inside your models/
directory. Edit these model files to tell ActiveRecord about the
relationships between tables. Do not edit *Base.php files as they
get overwritten every time you run generate.php</li>
<li>
<p>Use ActiveRecord, by including the models that you want to use:</p>

<pre><code>require_once 'models/Post.php';
</code></pre>
</li>
</ol>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2>

<h3>
<a id="create" class="anchor" href="#create" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Post</span>(<span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>First Post!11!<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>This is the body of my post<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># saves this post to the table</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$p2</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Post</span>();</span>
<span class="pl-s1"><span class="pl-smi">$p2</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Second Post<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p2</span><span class="pl-k">-&gt;</span><span class="pl-smi">body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>This is the body of the second post<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p2</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># save yet another post to the db</span></span></pre></div>

<h3>
<a id="retrieve" class="anchor" href="#retrieve" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retrieve</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>); <span class="pl-c"># finds the post with an id = 1</span></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span>; <span class="pl-c"># title of this post</span></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">body</span>;  <span class="pl-c"># body of this post</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"># returns the 10 most recent posts in an array, assuming you have a column called "timestamp"</span></span>
<span class="pl-s1"><span class="pl-smi">$posts</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>all<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>timestamp DESC<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>));</span></pre></div>

<h3>
<a id="update" class="anchor" href="#update" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Some new title<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># saves the change to the post</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"># alternatively, the following is useful when a form submits an array</span></span>
<span class="pl-s1"><span class="pl-smi">$_POST</span>[<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>New Title<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>New body here!<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>update_attributes(<span class="pl-smi">$_POST</span>[<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>]); <span class="pl-c"># saves the object with these attributes updated</span></span></pre></div>

<h3>
<a id="destroy" class="anchor" href="#destroy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Destroy</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>destroy();</span></pre></div>

<h3>
<a id="relationships" class="anchor" href="#relationships" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Relationships</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-c"># call to $p-&gt;comments results in query to get all comments for this post</span></span>
<span class="pl-s1"><span class="pl-c"># a subsequent call to $p-&gt;comments would not result in a query, but use results from previous query</span></span>
<span class="pl-s1"><span class="pl-k">foreach</span> (<span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">comments</span> <span class="pl-k">as</span> <span class="pl-smi">$comment</span>) {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> <span class="pl-smi">$comment</span><span class="pl-k">-&gt;</span><span class="pl-smi">content</span>;</span>
<span class="pl-s1">}</span></pre></div>

<h2>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Documentation</h2>

<p>While this attempts to document most of the features of ActiveRecord, it may not be entirely complete. I've tried to create tests for all pieces of functionality that exist in ActiveRecord. To view and / or run these tests check out the devel/ branch in the Subversion repository. In other words, there may be some functionality that is not documented here but is used in the tests.</p>

<p>For example purposes, let’s pretend we’re building a blog. You’ll have model classes which are each the model of a database table. Each model class is in a separate file. The stubs of these files are automatically generated for you by generate.php. Every time you update your database schema, you'll have to run generate.php again. It will not overwrite the files you've altered, but will overwrite the *Base.php files. Once you have the model stubs generated you can use them and work with the tables individually. However, in order to use the relationship specific abilities of ActiveRecord, you’ll need to specify the relationships in your models as outlined below in the Associations section.</p>

<h3>
<a id="associations" class="anchor" href="#associations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Associations</h3>

<p>In ActiveRecord we specify relationships between the tables in the model
classes. There are 3 types of relationships, 1:1, 1:many, and many:many.</p>

<h4>
<a id="11" class="anchor" href="#11" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1:1</h4>

<p>In our example, blog posts have a 1:1 relationship with slugs. Here’s
how you’d specify that inside the Post and Slug classes.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">/* inside Post.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$has_one</span>  <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>slug<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/* inside Slug.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$belongs_to</span>  <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>);</span></pre></div>

<p>In a 1:1 relationship we must specify each side of the relationship
slightly differently so that ActiveRecord knows the “direction” of the
relationship. We use belongs_to for the model whose table contains the
foreign key (post_id in this case). The other side of the relationship
uses has_one. Since an object could have multiple 1:1 relationships, we
use an array to allow for additional tables. Notice the singular use of
slug and post. The code tries to read like English as much as possible,
so later when we do 1:many relationships you’ll plural strings. After
you’ve specified this relationship you can do some extra things with
your models. On every slug and post object you can now do →post and
→slug to get its post and slug respectively as an ActiveRecord object.
Also you set assign a slug or post using this mechanism. Furthermore, a
save will cascade to the relationship.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$slug</span> <span class="pl-k">=</span> <span class="pl-c1">Slug</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>); <span class="pl-c"># SQL query to grab first slug</span></span>
<span class="pl-s1"><span class="pl-smi">$slug</span><span class="pl-k">-&gt;</span><span class="pl-smi">post</span>; <span class="pl-c"># an SQL query occurs behind the scenes to find the slug's post</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>slug<span class="pl-pds">'</span></span>)); <span class="pl-c"># SQL join</span></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">slug</span>; <span class="pl-c"># no SQL query here because we already got this post's slug in the SQL join in the previous line</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$s</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Slug</span>(<span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>slug<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>super-slug<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">slug</span> <span class="pl-k">=</span> <span class="pl-smi">$s</span>; <span class="pl-c"># assign a slug to this post</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">slug</span><span class="pl-k">-&gt;</span><span class="pl-smi">slug</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>foobar<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># cascading save (post and slug are saved)</span></span></pre></div>

<h4>
<a id="1many" class="anchor" href="#1many" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1:many</h4>

<p>In our example a post has many comments, but a comment only has one
post. Here’s how you’d specify it in the Post and Comment classes.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">/* inside Post.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$has_many</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>comments<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/* inside Comment.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$belongs_to</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>);</span></pre></div>

<p>Notice, we used plural “comments” for the has_many and a singular
“post” for belongs_to. Also notice how the comments table contains the
foreign key (post_id) and therefore is a belongs_to relationship. Once
we’ve done this Comment can do the same things as an 1:something
relationship can (see 1:1). Post now has some slight variations to the
features added in a 1:1 relationship. Now when accessing the attribute
comments you’d get an array of comment ActiveRecord objects that belong
to this Post.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">comments</span>[<span class="pl-c1">0</span>]<span class="pl-k">-&gt;</span><span class="pl-smi">body</span>;</span></pre></div>

<p>You can also get the list of comment ids that belong to this post by
calling →comment_ids. You can set the ids in a similar fashion.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$foo</span> <span class="pl-k">=</span> <span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">comment_ids</span>;</span>
<span class="pl-s1"><span class="pl-c"># foo is now an array of comment ids that belong to this post</span></span>
<span class="pl-s1"><span class="pl-c1">array_pop</span>(<span class="pl-smi">$foo</span>); <span class="pl-c"># pop off last comment id</span></span>
<span class="pl-s1"><span class="pl-c1">array_push</span>(<span class="pl-smi">$foo</span>, <span class="pl-c1">23</span>); <span class="pl-c"># and another comment id to $foo</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">comment_ids</span> <span class="pl-k">=</span> <span class="pl-smi">$foo</span>;</span>
<span class="pl-s1"><span class="pl-c">/* this will remove the comment we popped off of foo</span></span>
<span class="pl-s1"><span class="pl-c">    and add the comment we pushed onto foo to this post</span></span>
<span class="pl-s1"><span class="pl-c">*/</span></span></pre></div>

<p>You can also push new objects onto the relationships.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Comment</span>(<span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>author<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>anon<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>first comment!!11<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>comments_push(<span class="pl-smi">$c</span>); <span class="pl-c"># this call saves the new comment and associates with this post</span></span></pre></div>

<p>In this example, we might want to have comments destroyed when their
post is destroyed or when they are disassociated with their post. You
can have this happen by specifying the relationship slightly
differently. You can do this on any sort of relationship. Instead have
the following in the Post model.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">/* inside Post.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$has_many</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>comments<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>dependent<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>destroy<span class="pl-pds">'</span></span>)));</span></pre></div>

<h4>
<a id="manymany" class="anchor" href="#manymany" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>many:many</h4>

<p>A many:many relationship will have an intermediate table (and therefore
model) which ties two other tables together. In our example, there is a
many:many relationship between posts and categories. Our intermediate
table is categorizations. Here is how that is specified:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">/* inside Categorization.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$belongs_to</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>category<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/* inside Post.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$has_many</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(  <span class="pl-s"><span class="pl-pds">'</span>categorizations<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">                          <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>categories<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>through<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>categorizations<span class="pl-pds">'</span></span>)));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/* inside Category.php */</span></span>
<span class="pl-s1">  <span class="pl-k">protected</span> <span class="pl-smi">$has_many</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(  <span class="pl-s"><span class="pl-pds">'</span>categorizations<span class="pl-pds">'</span></span>, </span>
<span class="pl-s1">                          <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>posts<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>through<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>categorizations<span class="pl-pds">'</span></span>)));</span></pre></div>

<p>Since the categorizations table contains the foreign keys post_id and
category_id, it has a belongs_to relationship with those. The Post
model has a regular has_many relationship with categorizations and a
special has_many relationship with categories. We specify which table
that relationship goes through (categorizations), IOW which table is the
intermediate table of that relationship. The category to post
relationship is specified similarly. Posts and categories can now use
the special has_many methods documented in the 1:many relationship.</p>

<h3>
<a id="working-with-models" class="anchor" href="#working-with-models" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Working With Models</h3>

<p>This section applies to all models regardless of any associations they
may have.</p>

<h4>
<a id="create-1" class="anchor" href="#create-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create</h4>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Post</span>(<span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>First Post!11!<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>This is the body of my post<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># saves this post to the table</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$p2</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Post</span>();</span>
<span class="pl-s1"><span class="pl-smi">$p2</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Second Post<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p2</span><span class="pl-k">-&gt;</span><span class="pl-smi">body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>This is the body of the second post<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p2</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># save yet another post to the db</span></span></pre></div>

<h4>
<a id="retrieve-1" class="anchor" href="#retrieve-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retrieve</h4>

<p>Retrieving data involves finding the rows you want to look at and
subsequently grabbing the column data as needed. The first parameter for
the find method should be one of the following:</p>

<ul>
<li>  an id number</li>
<li>  an array of id numbers</li>
<li>  the string “first”</li>
<li>  the string “all”</li>
</ul>

<p>When the first parameter is an id number or the string “first”, the
result will be an ActiveRecord object. Otherwise, it will be an array of
ActiveRecord objects. The find method takes quite a few different
options for its second parameter by using “named parameters” by
accepting an array of key, value pairs. You can pass it the following
keys with sane values:</p>

<ul>
<li>  limit</li>
<li>  order</li>
<li>  group</li>
<li>  offset</li>
<li>  select</li>
<li>  conditions</li>
<li>  include (for associations)</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>); <span class="pl-c"># finds the post with an id = 1</span></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span>; <span class="pl-c"># title of this post</span></span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">body</span>;  <span class="pl-c"># body of this post</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"># returns the 10 most recent posts in an array, assuming you have a column called "timestamp"</span></span>
<span class="pl-s1"><span class="pl-smi">$posts</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>all<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>timestamp DESC<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>));</span></pre></div>

<h4>
<a id="update-1" class="anchor" href="#update-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update</h4>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Some new title<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>save(); <span class="pl-c"># saves the change to the post</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"># alternatively, the following is useful when a form submits an array</span></span>
<span class="pl-s1"><span class="pl-smi">$_POST</span>[<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>New Title<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>New body here!<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>update_attributes(<span class="pl-smi">$_POST</span>[<span class="pl-s"><span class="pl-pds">'</span>post<span class="pl-pds">'</span></span>]); <span class="pl-c"># saves the object with these attributes updated</span></span></pre></div>

<h4>
<a id="destroy-1" class="anchor" href="#destroy-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Destroy</h4>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-c1">1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$p</span><span class="pl-k">-&gt;</span>destroy();</span></pre></div>

<h4>
<a id="hooks" class="anchor" href="#hooks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hooks</h4>

<p>The following hooks are available, just define the method of the same
name in the model that you want to use them:</p>

<ul>
<li>  before_save</li>
<li>  before_create</li>
<li>  after_create</li>
<li>  before_update</li>
<li>  after_update</li>
<li>  after_save</li>
<li>  before_destroy</li>
<li>  after_destroy</li>
</ul>

<h4>
<a id="escaping-query-values" class="anchor" href="#escaping-query-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Escaping Query Values</h4>

<p>ActiveRecord will do proper escaping of query values passed to where
possible. However, it can’t do proper quoting when you do something like
the following.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>conditions<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>title = {<span class="pl-smi">$_GET</span>[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>]}<span class="pl-pds">"</span></span>));</span></pre></div>

<p>Instead you can use the quote static method to quote that value like so.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$title</span> <span class="pl-k">=</span> <span class="pl-c1">ActiveRecord</span><span class="pl-k">::</span>quote(<span class="pl-smi">$_GET</span>[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1"><span class="pl-smi">$p</span> <span class="pl-k">=</span> <span class="pl-c1">Post</span><span class="pl-k">::</span>find(<span class="pl-s"><span class="pl-pds">'</span>first<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>conditions<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>title = <span class="pl-smi">$title</span><span class="pl-pds">"</span></span>));</span></pre></div>

<h4>
<a id="manual-queries" class="anchor" href="#manual-queries" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Manual Queries</h4>

<p>Occasionally, though hopefully rarely, you may need to do specify some
queries by hand. You can use the query static method. This returns an
associative array with all the rows in it.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">ActiveRecord</span><span class="pl-k">::</span>query(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-c1">COUNT</span>(<span class="pl-k">*</span>) <span class="pl-k">FROM</span> bar <span class="pl-k">as</span> b1, bar <span class="pl-k">as</span> b2 <span class="pl-k">where</span> <span class="pl-c1">b2</span>.<span class="pl-c1">id</span> <span class="pl-k">!=</span> <span class="pl-c1">b1</span>.<span class="pl-c1">id</span></span><span class="pl-pds">"</span></span>);</span></pre></div>

<h3>
<a id="table-structure-for-example" class="anchor" href="#table-structure-for-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table Structure For Example</h3>

<div class="highlight highlight-source-sql"><pre><span class="pl-c">--</span>
<span class="pl-c">-- Table structure for table `categories`</span>
<span class="pl-c">--</span>

<span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> `<span class="pl-en">categories</span>` (
  <span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span> AUTO_INCREMENT,
  <span class="pl-s"><span class="pl-pds">`</span>name<span class="pl-pds">`</span></span> <span class="pl-k">varchar</span>(<span class="pl-c1">255</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-k">PRIMARY KEY</span>  (<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span>)
) TYPE<span class="pl-k">=</span>MyISAM;

<span class="pl-c">--</span>
<span class="pl-c">-- Table structure for table `categorizations`</span>
<span class="pl-c">--</span>

<span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> `<span class="pl-en">categorizations</span>` (
  <span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span> AUTO_INCREMENT,
  <span class="pl-s"><span class="pl-pds">`</span>post_id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-s"><span class="pl-pds">`</span>category_id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-k">PRIMARY KEY</span>  (<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span>)
) TYPE<span class="pl-k">=</span>MyISAM;

<span class="pl-c">--</span>
<span class="pl-c">-- Table structure for table `comments`</span>
<span class="pl-c">--</span>

<span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> `<span class="pl-en">comments</span>` (
  <span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span> AUTO_INCREMENT,
  <span class="pl-s"><span class="pl-pds">`</span>author<span class="pl-pds">`</span></span> <span class="pl-k">varchar</span>(<span class="pl-c1">255</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-s"><span class="pl-pds">`</span>body<span class="pl-pds">`</span></span> <span class="pl-k">text</span>,
  <span class="pl-s"><span class="pl-pds">`</span>post_id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-k">PRIMARY KEY</span>  (<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span>)
) TYPE<span class="pl-k">=</span>MyISAM;

<span class="pl-c">--</span>
<span class="pl-c">-- Table structure for table `posts`</span>
<span class="pl-c">--</span>

<span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> `<span class="pl-en">posts</span>` (
  <span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span> AUTO_INCREMENT,
  <span class="pl-s"><span class="pl-pds">`</span>title<span class="pl-pds">`</span></span> <span class="pl-k">varchar</span>(<span class="pl-c1">255</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-s"><span class="pl-pds">`</span>body<span class="pl-pds">`</span></span> <span class="pl-k">text</span>,
  <span class="pl-k">PRIMARY KEY</span>  (<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span>)
) TYPE<span class="pl-k">=</span>MyISAM;

<span class="pl-c">--</span>
<span class="pl-c">-- Table structure for table `slugs`</span>
<span class="pl-c">--</span>

<span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> `<span class="pl-en">slugs</span>` (
  <span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span> AUTO_INCREMENT,
  <span class="pl-s"><span class="pl-pds">`</span>slug<span class="pl-pds">`</span></span> <span class="pl-k">varchar</span>(<span class="pl-c1">255</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-s"><span class="pl-pds">`</span>post_id<span class="pl-pds">`</span></span> <span class="pl-k">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span>,
  <span class="pl-k">PRIMARY KEY</span>  (<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span>)
) TYPE<span class="pl-k">=</span>MyISAM;</pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/lukebaker">lukebaker</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
